@model FacturacionElectronicaSV.ViewModels.FacturaViewModel
@{
    ViewData["Title"] = "Crear Factura";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

<style>
    body {
        background: linear-gradient(to right, #007bff, #00c6ff);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Segoe UI', sans-serif;
    }

    .factura-card {
        width: 100%;
        max-width: 1000px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(0,0,0,0.2);
        animation: fadeIn 0.8s ease-in-out;
        background-color: white;
        padding: 30px;
    }

    @@keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .factura-header {
        background-color: #004080;
        color: white;
        text-align: center;
        padding: 20px;
        border-radius: 10px 10px 0 0;
    }

    .form-label {
        font-weight: 600;
    }

    .table th, .table td {
        vertical-align: middle;
    }

    .btn-generar:hover {
        transform: scale(1.03);
    }

    .text-danger {
        font-size: 0.85rem;
    }
</style>

<div class="factura-card">
    <div class="factura-header">
        <img src="~/images/logo-digifactura.png" alt="Logo DigiFactura SV" width="60" class="mb-2" />
        <h4 class="mb-0">DigiFactura SV</h4>
        <small>Creación de Documento Tributario Electrónico</small>

        <div class="row g-3 mt-3">
            <div class="col-md-6">
                <label class="form-label fw-bold text-primary">Fecha DTE</label>
                <input type="text" class="form-control bg-light border-0" id="campoFechaDTE" readonly />
            </div>
            <div class="col-md-6">
                <label class="form-label fw-bold text-primary">Hora</label>
                <input type="text" class="form-control bg-light border-0" id="campoHoraDTE" readonly />
            </div>
        </div>
        <div class="row g-3 mt-2">
            <div class="col-md-6">
                <label asp-for="NumeroDTE" class="form-label fw-bold text-success">Número DTE</label>
                <input asp-for="NumeroDTE" class="form-control bg-light border-0" readonly />
                <span asp-validation-for="NumeroDTE" class="text-danger"></span>
            </div>
        </div>


        <!-- Campos ocultos para enviar al backend -->
        <input type="hidden" asp-for="FechaDTE" id="inputFechaDTE" />
        <input type="hidden" asp-for="HoraDTE" id="inputHoraDTE" />
    </div>


    <form asp-action="Generar" method="post" class="mt-4" id="formGenerarDTE">
        <h5 class="mt-4">Detalle de Factura</h5>
        <table class="table table-bordered table-sm" id="tablaDetalles">
            <thead class="table-light">
                <tr>
                    <th style="width: 40px;"></th>
                    <th>Código</th>
                    <th>Descripción</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Venta Gravada</th>
                    <th>IVA</th>
                    <th>Producto</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="text-end mb-3">
            <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#modalAgregarItem">
                <i class="fas fa-plus-circle"></i> Agregar ítem
            </button>
        </div>

        <h5 class="mt-4">Resumen de Totales</h5>
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Retención IVA</label>
                <input type="number" class="form-control" name="RetencionIVA" value="0.00" readonly />
            </div>
            <div class="col-md-4">
                <label class="form-label">Retención Renta</label>
                <input type="number" class="form-control" name="RetencionRenta" value="0.00" readonly />
            </div>
            <div class="col-md-4">
                <label class="form-label">Subtotal</label>
                <input type="number" class="form-control" name="ResumenSubtotal" value="0.00" readonly />
            </div>
            <div class="col-md-6">
                <label class="form-label">Monto Total de la operación</label>
                <input type="number" class="form-control" name="MontoOperacion" value="0.00" readonly />
            </div>
            <div class="col-md-6">
                <label class="form-label">Total a pagar</label>
                <input type="number" class="form-control" name="TotalPagarResumen" value="0.00" readonly />
            </div>
        </div>
        <hr />


        <h5 class="mt-4">Datos del Receptor</h5>
        <h5 class="mt-4">Datos del Receptor</h5>
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <label asp-for="Receptor.TipoDocumento" class="form-label">Tipo Documento</label>
                <select asp-for="Receptor.TipoDocumento" class="form-select" id="tipoDocumentoReceptor">
                    <option value="">Seleccione...</option>
                    <option value="DUI">DUI</option>
                    <option value="NIT">NIT</option>
                    <option value="Pasaporte">Pasaporte</option>
                </select>
                <span asp-validation-for="Receptor.TipoDocumento" class="text-danger"></span>
            </div>
            <div class="col-md-8" id="grupoNumeroDocumentoReceptor">
                <label class="form-label">Número de Documento</label>
                <input type="text" class="form-control" name="Receptor.NumeroDocumento" />
            </div>
            <div class="col-md-6">
                <label asp-for="Receptor.Nombre" class="form-label">Nombre o Razón Social</label>
                <input asp-for="Receptor.Nombre" class="form-control" />
                <span asp-validation-for="Receptor.Nombre" class="text-danger"></span>
            </div>
            <div class="col-md-4">
                <label asp-for="Receptor.Departamento" class="form-label">Departamento</label>
                <input asp-for="Receptor.Departamento" class="form-control" />
                <span asp-validation-for="Receptor.Departamento" class="text-danger"></span>
            </div>
            <div class="col-md-4">
                <label asp-for="Receptor.Municipio" class="form-label">Municipio</label>
                <input asp-for="Receptor.Municipio" class="form-control" />
                <span asp-validation-for="Receptor.Municipio" class="text-danger"></span>
            </div>
            <div class="col-md-4">
                <label asp-for="Receptor.Complemento" class="form-label">Complemento</label>
                <input asp-for="Receptor.Complemento" class="form-control" />
                <span asp-validation-for="Receptor.Complemento" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="Receptor.Email" class="form-label">Correo electrónico</label>
                <input asp-for="Receptor.Email" class="form-control" />
                <span asp-validation-for="Receptor.Email" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="Receptor.Telefono" class="form-label">Teléfono</label>
                <input asp-for="Receptor.Telefono" class="form-control" />
                <span asp-validation-for="Receptor.Telefono" class="text-danger"></span>
            </div>
        </div>

        <hr />

        <h5 class="mt-4">Datos del Emisor</h5>
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <label asp-for="Emisor.TipoDocumento" class="form-label">Tipo Documento</label>
                <select asp-for="Emisor.TipoDocumento" class="form-select" id="tipoDocumentoEmisor">
                    <option value="">Seleccione...</option>
                    <option value="DUI">DUI</option>
                    <option value="NIT">NIT</option>
                    <option value="Pasaporte">Pasaporte</option>
                </select>
                <span asp-validation-for="Emisor.TipoDocumento" class="text-danger"></span>
            </div>
            <div class="col-md-8" id="grupoNumeroDocumentoEmisor">
                <label class="form-label">Número de Documento</label>
                <input type="text" class="form-control" name="Emisor.NumeroDocumento" />
            </div>
            <div class="col-md-8">
                <label asp-for="Emisor.Nombre" class="form-label">Nombre o Razón Social</label>
                <input asp-for="Emisor.Nombre" class="form-control" />
                <span asp-validation-for="Emisor.Nombre" class="text-danger"></span>
            </div>
            <div class="col-md-4">
                <label asp-for="Emisor.Departamento" class="form-label">Departamento</label>
                <input asp-for="Emisor.Departamento" class="form-control" />
                <span asp-validation-for="Emisor.Departamento" class="text-danger"></span>
            </div>
            <div class="col-md-4">
                <label asp-for="Emisor.Municipio" class="form-label">Municipio</label>
                <input asp-for="Emisor.Municipio" class="form-control" />
                <span asp-validation-for="Emisor.Municipio" class="text-danger"></span>
            </div>
            <div class="col-md-4">
                <label asp-for="Emisor.Complemento" class="form-label">Complemento</label>
                <input asp-for="Emisor.Complemento" class="form-control" />
                <span asp-validation-for="Emisor.Complemento" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="Emisor.Correo" class="form-label">Correo electrónico</label>
                <input asp-for="Emisor.Correo" class="form-control" />
                <span asp-validation-for="Emisor.Correo" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="Emisor.Telefono" class="form-label">Teléfono</label>
                <input asp-for="Emisor.Telefono" class="form-control" />
                <span asp-validation-for="Emisor.Telefono" class="text-danger"></span>
            </div>
        </div>

        <hr />

        <div class="row">
            <div class="col-md-6 mb-3">
                <label asp-for="FormaPago" class="form-label">Forma de Pago</label>
                <div class="input-group">
                    <select asp-for="FormaPago" class="form-select">
                        @foreach (var fp in ViewBag.FormasPago)
                        {
                            <option value="@fp.Codigo">@fp.Nombre</option>
                        }
                    </select>
                    <button type="button" class="btn btn-outline-primary" id="btnConfirmarPago">
                        <i class="fas fa-check"></i>
                    </button>
                </div>
                <span asp-validation-for="FormaPago" class="text-danger"></span>
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">Monto Confirmado</label>
                <input type="number" class="form-control" id="montoConfirmado" readonly />
            </div>
        </div>

        <input type="hidden" name="confirmarContrasena" id="campoConfirmarContrasena" />

        <input type="hidden" name="SubTotal" id="campoSubTotal" />
        <input type="hidden" name="TotalIVA" id="campoTotalIVA" />
        <input type="hidden" name="TotalPagar" id="campoTotalPagar" />
        <input type="hidden" name="TotalLetras" id="campoTotalLetras" />

        <div class="text-center mt-4">
            <button type="button" class="btn btn-success px-5" data-bs-toggle="modal" data-bs-target="#modalConfirmarDTE">
                Generar DTE
            </button>
        </div>

        <div class="text-center mt-4">
            <button type="button" class="btn btn-secondary px-4" id="volverBtn">
                Volver al Panel
            </button>
        </div>

        <div id="mensajeVolver" class="alert alert-info text-center mt-3" style="display:none; border-radius:8px;">
            <i class="fas fa-info-circle"></i> Volviendo al panel en <span id="contador">3</span>...
        </div>
        
    </form>

</div>


<!-- Modal flotante para agregar ítem -->
<div class="modal fade" id="modalAgregarItem" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="modalLabel">Adición detalle de DTE</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Tipo</label>
                        <input type="text" class="form-control" value="1 - Bien" readonly />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Cantidad</label>
                        <input type="number" class="form-control" id="cantidad" required />
                        <small class="text-danger d-none" id="valCantidad">Requerido.</small>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Nombre Producto</label>
                        <input type="text" class="form-control" id="descripcion" required />
                        <small class="text-danger d-none" id="valDescripcion">Requerido.</small>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Tipo Venta</label>
                        <input type="text" class="form-control" value="Gravado" readonly />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Precio</label>
                        <input type="number" class="form-control" id="precioUnitario" required />
                    </div>
                </div>

                <hr class="my-4" />
                <h6>Información de los tributos</h6>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Impuesto</label>
                        <select class="form-select" id="impuesto">
                            <option value="13">Impuesto al Valor Agregado 13%</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Descuento</label>
                        <input type="number" class="form-control" id="descuento" value="0" />
                    </div>
                </div>

                <div class="mt-3 text-end">
                    <strong>Total: $<span id="totalCalculado">0.00</span></strong>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" id="btnConfirmarItem">Agregar ítem</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Confirmar generación -->
<div class="modal fade" id="modalConfirmarDTE" tabindex="-1" aria-labelledby="modalDTELabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="modalDTELabel">Confirmar generación de DTE</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <label class="form-label">Ingrese su contraseña para confirmar</label>
                <input type="password" class="form-control" id="confirmarContrasena" />
                <small class="text-danger d-none" id="valContrasena">Debe ingresar su contraseña.</small>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" id="btnGenerarDTE">Confirmar y Generar</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
</div>

<script>
    let itemIndex = 0;
    let subtotalGlobal = 0;
    let ivaGlobal = 0;

    const tabla = document.getElementById("tablaDetalles").getElementsByTagName("tbody")[0];

    // Confirmar ítem
    document.getElementById("btnConfirmarItem").addEventListener("click", function () {
        const cantidad = document.getElementById("cantidad").value.trim();
        const descripcion = document.getElementById("descripcion").value.trim();
        const precio = parseFloat(document.getElementById("precioUnitario").value) || 0;
        const descuento = parseFloat(document.getElementById("descuento").value) || 0;
        const impuesto = parseFloat(document.getElementById("impuesto").value) || 0;

        // Validaciones visuales
        document.getElementById("valCantidad").classList.toggle("d-none", cantidad !== "");
        document.getElementById("valDescripcion").classList.toggle("d-none", descripcion !== "");

        if (!cantidad || !descripcion) return;

        // Cálculos por ítem
        const ventaGravada = precio * cantidad;
        const iva = ventaGravada * (impuesto / 100);
        const total = ventaGravada - descuento + iva;

        // Acumuladores globales
        subtotalGlobal += ventaGravada;
        ivaGlobal += iva;

        // Actualizar totales en pantalla
        actualizarTotales();

        document.getElementById("totalCalculado").textContent = total.toFixed(2);

        // Insertar fila en tabla
        const fila = tabla.insertRow();
        fila.innerHTML = `
            <td class="text-center">
                <button type="button" class="btn btn-sm btn-danger btnEliminarFila">&times;</button>
            </td>
            <td><input name="Detalles[${itemIndex}].Codigo" class="form-control form-control-sm" value="AUTO" readonly /></td>
            <td><input name="Detalles[${itemIndex}].Descripcion" class="form-control form-control-sm" value="${descripcion}" /></td>
            <td><input name="Detalles[${itemIndex}].Cantidad" class="form-control form-control-sm" value="${cantidad}" /></td>
            <td><input name="Detalles[${itemIndex}].PrecioUnitario" class="form-control form-control-sm" value="${precio}" /></td>
            <td><input name="Detalles[${itemIndex}].VentaGravada" class="form-control form-control-sm" value="${ventaGravada.toFixed(2)}" /></td>
            <td><input name="Detalles[${itemIndex}].IVA" class="form-control form-control-sm" value="${iva.toFixed(2)}" /></td>
            <td><input name="Detalles[${itemIndex}].Producto" class="form-control form-control-sm" value="Bien" /></td>
        `;

        itemIndex++;

        // Reset campos y cerrar modal
        limpiarCamposModal();
        bootstrap.Modal.getInstance(document.getElementById("modalAgregarItem")).hide();
    });

    // Cancelar ítem
    document.querySelector('#modalAgregarItem .btn-secondary').addEventListener('click', function () {
        limpiarCamposModal();
    });

    // Eliminar ítem
    tabla.addEventListener("click", function (e) {
        if (e.target.classList.contains("btnEliminarFila")) {
            const fila = e.target.closest("tr");
            const ventaGravada = parseFloat(fila.querySelector('input[name*="VentaGravada"]').value) || 0;
            const iva = parseFloat(fila.querySelector('input[name*="IVA"]').value) || 0;

            subtotalGlobal -= ventaGravada;
            ivaGlobal -= iva;

            fila.remove();
            actualizarTotales();
        }
    });

    // Función para actualizar totales
        function actualizarTotales() {
        const total = subtotalGlobal + ivaGlobal;

        document.querySelector('input[name="ResumenSubtotal"]').value = subtotalGlobal.toFixed(2);
        document.querySelector('input[name="RetencionIVA"]').value = "0.00";
        document.querySelector('input[name="RetencionRenta"]').value = "0.00";
        document.querySelector('input[name="MontoOperacion"]').value = total.toFixed(2);
        document.querySelector('input[name="TotalPagarResumen"]').value = total.toFixed(2);

        // Campos ocultos para el backend
        document.getElementById("campoSubTotal").value = subtotalGlobal.toFixed(2);
        document.getElementById("campoTotalIVA").value = ivaGlobal.toFixed(2);
        document.getElementById("campoTotalPagar").value = total.toFixed(2);
        document.getElementById("campoTotalLetras").value = convertirNumeroALetras(total);
    }


    // confirmar pago

    const btnConfirmarPago = document.getElementById("btnConfirmarPago");
    const montoConfirmado = document.getElementById("montoConfirmado");
    const montoUSD = document.getElementById("montoUSD");

    btnConfirmarPago.addEventListener("click", function () {
        const total = parseFloat(document.querySelector('input[name="TotalPagarResumen"]').value) || 0;
        montoConfirmado.value = total.toFixed(2);
    });


    //funcion parala contraseña
        document.getElementById("btnGenerarDTE").addEventListener("click", function () {
        const contrasenaIngresada = document.getElementById("confirmarContrasena").value.trim();
        const campoConfirmar = document.getElementById("campoConfirmarContrasena");
        const form = document.getElementById("formGenerarDTE");

        if (!contrasenaIngresada) {
            document.getElementById("valContrasena").classList.remove("d-none");
            return;
        }

        campoConfirmar.value = contrasenaIngresada;
        document.getElementById("valContrasena").classList.add("d-none");

        form.submit();
    });



    // Función para limpiar campos del modal
    function limpiarCamposModal() {
        document.getElementById("cantidad").value = "";
        document.getElementById("descripcion").value = "";
        document.getElementById("precioUnitario").value = "";
        document.getElementById("descuento").value = "0";
        document.getElementById("totalCalculado").textContent = "0.00";

        document.getElementById("valCantidad").classList.add("d-none");
        document.getElementById("valDescripcion").classList.add("d-none");
    }

    ["cantidad", "precioUnitario", "descuento", "impuesto"].forEach(id => {
        document.getElementById(id).addEventListener("input", calcularTotalTemporal);
    });

    function calcularTotalTemporal() {
        const cantidad = parseFloat(document.getElementById("cantidad").value) || 0;
        const precio = parseFloat(document.getElementById("precioUnitario").value) || 0;
        const descuento = parseFloat(document.getElementById("descuento").value) || 0;
        const impuesto = parseFloat(document.getElementById("impuesto").value) || 0;

        const ventaGravada = precio * cantidad;
        const iva = ventaGravada * (impuesto / 100);
        const total = ventaGravada - descuento + iva;

        document.getElementById("totalCalculado").textContent = total.toFixed(2);
    }
     // Mostrar/ocultar campo Número de Documento del Receptor
    function toggleNumeroDocumentoReceptor() {
        const tipo = document.getElementById("tipoDocumentoReceptor").value;
        const grupo = document.getElementById("grupoNumeroDocumentoReceptor");
        grupo.style.display = (tipo === "DUI" || tipo === "NIT" || tipo === "Pasaporte") ? "block" : "none";
    }

    document.getElementById("tipoDocumentoReceptor").addEventListener("change", toggleNumeroDocumentoReceptor);
    window.addEventListener("DOMContentLoaded", toggleNumeroDocumentoReceptor);

    // Mostrar/ocultar campo Número de Documento del Emisor
    function toggleNumeroDocumentoEmisor() {
        const tipo = document.getElementById("tipoDocumentoEmisor").value;
        const grupo = document.getElementById("grupoNumeroDocumentoEmisor");
        grupo.style.display = (tipo === "DUI" || tipo === "NIT" || tipo === "Pasaporte") ? "block" : "none";
    }

    document.getElementById("tipoDocumentoEmisor").addEventListener("change", toggleNumeroDocumentoEmisor);
    window.addEventListener("DOMContentLoaded", toggleNumeroDocumentoEmisor);


    // Mostrar fecha y hora actual en campos DTE
    function mostrarFechaHoraDTE() {
        const ahora = new Date();
        const fecha = ahora.toLocaleDateString('es-SV');
        const hora = ahora.toLocaleTimeString('es-SV', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

        document.getElementById("campoFechaDTE").value = fecha;
        document.getElementById("campoHoraDTE").value = hora;
        document.getElementById("inputFechaDTE").value = fecha;
        document.getElementById("inputHoraDTE").value = hora;
    }

        window.addEventListener("DOMContentLoaded", mostrarFechaHoraDTE);

          // Convertir numeros a letras
    function convertirNumeroALetras(numero) {
        const unidades = ["", "uno", "dos", "tres", "cuatro", "cinco", "seis", "siete", "ocho", "nueve"];
        const decenas = ["", "diez", "veinte", "treinta", "cuarenta", "cincuenta", "sesenta", "setenta", "ochenta", "noventa"];
        const especiales = {
            10: "diez", 11: "once", 12: "doce", 13: "trece", 14: "catorce", 15: "quince",
            16: "dieciséis", 17: "diecisiete", 18: "dieciocho", 19: "diecinueve"
        };

        function convertirParteEntera(n) {
            if (n === 0) return "cero";
            if (n < 10) return unidades[n];
            if (n < 20) return especiales[n];
            if (n < 100) {
                const d = Math.floor(n / 10);
                const u = n % 10;
                return decenas[d] + (u > 0 ? " y " + unidades[u] : "");
            }
            if (n < 1000) {
                const c = Math.floor(n / 100);
                const r = n % 100;
                const centenas = c === 1 ? "ciento" : c === 5 ? "quinientos" : c === 7 ? "setecientos" : c === 9 ? "novecientos" : unidades[c] + "cientos";
                return (n === 100 ? "cien" : centenas + (r > 0 ? " " + convertirParteEntera(r) : ""));
            }
            if (n < 1000000) {
                const miles = Math.floor(n / 1000);
                const resto = n % 1000;
                const milesTexto = miles === 1 ? "mil" : convertirParteEntera(miles) + " mil";
                return milesTexto + (resto > 0 ? " " + convertirParteEntera(resto) : "");
            }
            return "Número demasiado grande";
        }

        const partes = numero.toFixed(2).split(".");
        const parteEntera = parseInt(partes[0]);
        const parteDecimal = partes[1];

        return convertirParteEntera(parteEntera) + " dólares con " + parteDecimal + "/100";
    }

        // Botón volver con cuenta regresiva
    document.getElementById("volverBtn").addEventListener("click", function () {
        const mensaje = document.getElementById("mensajeVolver");
        const contador = document.getElementById("contador");
        let tiempo = 3;

        mensaje.style.display = "block";

        const intervalo = setInterval(() => {
            tiempo--;
            contador.textContent = tiempo;

            if (tiempo === 0) {
                clearInterval(intervalo);
                window.location.href = "/Documento/Index";
            }
        }, 1000);
    });

</script>